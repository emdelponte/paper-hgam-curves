nudge_x = 2,
size = 2.8,
show.legend = FALSE,
segment.size = 0.2,
segment.alpha = 0.6
) +
expand_limits(x = max(pred_cult2$DAE, na.rm = TRUE) + 8) +
scale_color_manual(values = phen_cols, drop = FALSE) +
labs(x = "Days after emergence (DAE)",
y = "Environment-adjusted mean severity",
color = "Phenotype", linetype = "Resistance") +
theme(legend.position = "bottom")
ddata <- ggdendro::dendro_data(as.dendrogram(hc), type = "rectangle")
lab_map <- cluster_table2 %>%
mutate(label = Hibrido,
label_short = shorten_hybrid(Hibrido),
lab_col = phen_cols[as.character(phenotype)]) %>%
select(label, label_short, lab_col)
lab_df <- ddata$labels %>%
left_join(lab_map, by = c("label" = "label")) %>%
mutate(label_short = ifelse(is.na(label_short), shorten_hybrid(label), label_short))
p_dend <- ggplot() +
geom_segment(data = ddata$segments,
aes(x = x, y = y, xend = xend, yend = yend),
linewidth = 0.45) +
geom_text(data = lab_df,
aes(x = x, y = y - 0.02 * max(ddata$segments$y),
label = label_short, color = I(lab_col)),
angle = 90, hjust = 1, size = 3) +
labs(x = NULL, y = "Functional distance") +
theme_classic(base_size = 14) +
theme(axis.line.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x  = element_blank()) +
coord_cartesian(clip = "off") +
theme(plot.margin = margin(t = 5.5, r = 5.5, b = 18, l = 5.5))
h_cut <- hc$height[length(hc$height) - (k_clusters - 1)]
p_dend <- p_dend +
geom_hline(yintercept = h_cut, linetype = "dashed",
linewidth = 0.5, color = "grey30")
fig_final <- (p_hibridos | p_dend) + plot_annotation(tag_levels = "A")
fig_final
# ggsave("Figure2_functional_phenotypes.png", fig_final, width = 12, height = 5.5, dpi = 300)
# 3. Visualização da Rede Funcional
p_network <- ggraph(graph_func, layout = "stress") +
# As arestas (linhas) mostram quão parecidas são as curvas
geom_edge_link(aes(alpha = weight), color = "grey70", show.legend = FALSE) +
# Os nós são os híbridos, coloridos pelo Fenótipo (P1-P4)
geom_node_point(aes(color = phenotype), size = 6) +
# Labels usando sua função de encurtar nomes
geom_node_text(aes(label = label_short), repel = TRUE, size = 3.5, fontface = "bold") +
scale_color_manual(values = phen_cols) + # Usa suas cores já definidas
theme_graph() +
labs(title = "Functional Similarity Network",
subtitle = paste0("Edges represent L2 similarity > ", threshold),
color = "Phenotype", shape = "Resistance") +
theme(legend.position = "right")
p_network
cluster_table2
cluster_table2 <- left_join(cluster_table2, bipolaris_df)
#| label: figure-functional-panels
cols <- c("#D55E00", "#0072B2", "#009E73", "#CC79A7")[1:k_clusters]
phen_cols <- setNames(cols, levels(cluster_table2$phenotype))
pred_cult2 <- pred_cult %>%
left_join(cluster_table2 %>% select(Hibrido, phenotype), by = "Hibrido") %>%
mutate(hybrid_short = shorten_hybrid(Hibrido))
pred_cult2 <- left_join(pred_cult2, bipolaris_df)
label_df <- pred_cult2 %>%
group_by(Hibrido) %>%
filter(DAE == max(DAE, na.rm = TRUE)) %>%
ungroup()
p_hibridos <- ggplot(pred_cult2,
aes(x = DAE, y = mu, group = Hibrido, linetype  = resistance, color = phenotype)) +
geom_line(linewidth = 1.1, alpha = 0.95) +
ggrepel::geom_text_repel(
data = label_df,
aes(label = hybrid_short),
hjust = 0, direction = "y",
nudge_x = 2,
size = 2.8,
show.legend = FALSE,
segment.size = 0.2,
segment.alpha = 0.6
) +
expand_limits(x = max(pred_cult2$DAE, na.rm = TRUE) + 8) +
scale_color_manual(values = phen_cols, drop = FALSE) +
labs(x = "Days after emergence (DAE)",
y = "Environment-adjusted mean severity",
color = "Phenotype", linetype = "Resistance") +
theme(legend.position = "bottom")
ddata <- ggdendro::dendro_data(as.dendrogram(hc), type = "rectangle")
lab_map <- cluster_table2 %>%
mutate(label = Hibrido,
label_short = shorten_hybrid(Hibrido),
lab_col = phen_cols[as.character(phenotype)]) %>%
select(label, label_short, lab_col)
lab_df <- ddata$labels %>%
left_join(lab_map, by = c("label" = "label")) %>%
mutate(label_short = ifelse(is.na(label_short), shorten_hybrid(label), label_short))
p_dend <- ggplot() +
geom_segment(data = ddata$segments,
aes(x = x, y = y, xend = xend, yend = yend),
linewidth = 0.45) +
geom_text(data = lab_df,
aes(x = x, y = y - 0.02 * max(ddata$segments$y),
label = label_short, color = I(lab_col)),
angle = 90, hjust = 1, size = 3) +
labs(x = NULL, y = "Functional distance") +
theme_classic(base_size = 14) +
theme(axis.line.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x  = element_blank()) +
coord_cartesian(clip = "off") +
theme(plot.margin = margin(t = 5.5, r = 5.5, b = 18, l = 5.5))
h_cut <- hc$height[length(hc$height) - (k_clusters - 1)]
p_dend <- p_dend +
geom_hline(yintercept = h_cut, linetype = "dashed",
linewidth = 0.5, color = "grey30")
fig_final <- (p_hibridos | p_dend) + plot_annotation(tag_levels = "A")
fig_final
# ggsave("Figure2_functional_phenotypes.png", fig_final, width = 12, height = 5.5, dpi = 300)
library(tidygraph)
library(ggraph)
# 1. Transformar a matriz de distância L2 em similaridade
# A similaridade vai de 0 a 1 (1 = curvas idênticas)
sim_matrix <- 1 - (D_cult / max(D_cult))
# 2. Criar o objeto de rede
# Definimos um threshold (ex: 0.7) para mostrar apenas conexões fortes
# Isso evita que o gráfico vire uma "teia" ilegível
threshold <- 0.7
adj_matrix <- sim_matrix
adj_matrix[adj_matrix < threshold] <- 0
# Criar o grafo a partir da matriz
graph_func <- as_tbl_graph(adj_matrix, directed = FALSE) %>%
activate(nodes) %>%
# Limpar os nomes usando sua função utilitária
mutate(label_short = shorten_hybrid(name)) %>%
# Trazer os metadados (Fenótipo e Resistência) do seu cluster_table2
left_join(cluster_table2, by = c("name" = "Hibrido"))
# 3. Visualização da Rede Funcional
p_network <- ggraph(graph_func, layout = "stress") +
# As arestas (linhas) mostram quão parecidas são as curvas
geom_edge_link(aes(alpha = weight), color = "grey70", show.legend = FALSE) +
# Os nós são os híbridos, coloridos pelo Fenótipo (P1-P4)
geom_node_point(aes(color = phenotype, shape = resistance), size = 6) +
# Labels usando sua função de encurtar nomes
geom_node_text(aes(label = label_short), repel = TRUE, size = 3.5, fontface = "bold") +
scale_color_manual(values = phen_cols) + # Usa suas cores já definidas
theme_graph() +
labs(title = "Functional Similarity Network",
subtitle = paste0("Edges represent L2 similarity > ", threshold),
color = "Phenotype", shape = "Resistance") +
theme(legend.position = "right")
p_network
pred_cult2
View(pred_cult2)
# Escolha um híbrido que você percebeu ser estável e um instável nos dados
# (Exemplo hipotético: H1 e H2)
hibridos_selecionados <- c("AG 8701 PRO4", "AG 9021 PRO3")
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
dat0$Ambiente
dat0$Ambiente
table(dat0$Ambiente)
dat0 |>
select(Hibrido, Ambiente)
dat0 |>
select(Hibrido, Ambiente) |>
group_by(Hibrido, Ambiente) |>
slice(1)
hib <- dat0 |>
select(Hibrido, Ambiente) |>
group_by(Hibrido, Ambiente) |>
slice(1)
cluster_table2 <- left_join(cluster_table2, hib)
View(cluster_table2)
# Escolha um híbrido que você percebeu ser estável e um instável nos dados
# (Exemplo hipotético: H1 e H2)
hibridos_selecionados <- c("AG 8701 PRO4", "AG 9021 PRO3")
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
View(pred_cult2)
pred_cult2 <- pred_cult %>%
left_join(cluster_table2 %>% select(Hibrido, phenotype), by = "Hibrido") %>%
mutate(hybrid_short = shorten_hybrid(Hibrido))
pred_cult2 <- left_join(pred_cult2, bipolaris_df)
View(pred_cult2)
p_gxe_funcional
pred_cult2
pred_cult2 <- left_join(pred_cult2, hib)
pred_cult2
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
# Escolha um híbrido que você percebeu ser estável e um instável nos dados
# (Exemplo hipotético: H1 e H2)
hibridos_selecionados <- c("AG 8701 PRO4", "CRWX03")
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
# facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
p_gxe_funcional <- pred_cult2 %>%
filter(Hibrido %in% hibridos_selecionados) %>%
ggplot(aes(x = DAE, y = mu, group = Ambiente, color = Ambiente)) +
geom_line(linewidth = 1, alpha = 0.8) +
facet_wrap(~Hibrido, scales = "free_y") + # Facetamos para comparar lado a lado
scale_color_viridis_d(option = "plasma") +
labs(title = "Functional GxE: Stable vs. Unstable Trajectories",
subtitle = "Stable hybrids keep their 'shape' across environments; Unstable ones deform.",
x = "Days After Emergence (DAE)",
y = "Predicted Severity (mu)") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
p_gxe_funcional
# Ver quantos ambientes cada híbrido tem
pred_cult2 %>%
group_by(Hibrido) %>%
summarise(n_ambientes = n_distinct(Ambiente)) # ou o nome da sua coluna de local
# Substitua 'Ambiente' pelo nome correto da sua coluna (ex: Local, Site, Exp)
nome_coluna_ambiente <- "Ambiente"
p_gxe_funcional <- pred_cult2 %>%
# Filtrando dois híbridos contrastantes (um estável e um instável)
# Certifique-se de que os nomes abaixo existam exatamente no seu dado
filter(Hibrido %in% c("DKB 230 PRO3", "T 1503 PWU")) %>%
ggplot(aes(x = DAE, y = mu,
group = interaction(Hibrido, !!sym(nome_coluna_ambiente)),
color = !!sym(nome_coluna_ambiente))) +
geom_line(linewidth = 1.1, alpha = 0.8) +
facet_wrap(~Hibrido) +
scale_color_viridis_d(option = "turbo") + # 'turbo' ajuda a distinguir bem os 6 locais
labs(title = "Visualização de GxE Funcional",
subtitle = "Cada linha representa a trajetória em um ambiente diferente",
x = "Dias Após Emergência (DAE)",
y = "Severidade Predita (mu)",
color = "Ambiente") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
p_gxe_funcional
# Criar uma variável de interação no seu dataframe 'dat'
dat$HibAmb <- interaction(dat$Hibrido, dat$Ambiente)
m_gam_gxe <- mgcv::bam(
y ~ s(DAE, k = 10) +
s(DAE, Ambiente, bs = "fs", k = 6) +
s(DAE, Hibrido,  bs = "fs", k = 6) +
s(DAE, HibAmb,   bs = "fs", k = 6) + # ESTA é a interação GxE funcional
s(curve_id, bs = "re"),
family = mgcv::betar(link = "logit"),
data = dat,
method   = "fREML",
discrete = TRUE,
gamma    = 1.4,
select   = TRUE
)
m_gam_gxe <- mgcv::bam(
y ~ s(DAE, k = 10) +
s(DAE, Ambiente, bs = "fs", k = 4) +
s(DAE, Hibrido,  bs = "fs", k = 4) +
s(DAE, HibAmb,   bs = "fs", k = 4) + # ESTA é a interação GxE funcional
s(curve_id, bs = "re"),
family = mgcv::betar(link = "logit"),
data = dat,
method   = "fREML",
discrete = TRUE,
gamma    = 1.4,
select   = TRUE
)
mgcv::gam.check(m_gam_gxe)
AIC(m_gam_gxe)
AIC(m_gam_gxe, m_gam2)
summary(m_gam_gxe
summary(m_gam_gxe)
summary(m_gam_gxe)
# Criar grid de predição
grid_pred <- expand.grid(
DAE = seq(min(dat$DAE), max(dat$DAE), length.out = 120),
HibAmb = unique(dat$HibAmb),
curve_id = dat$curve_id[1] # valor de referência para o efeito aleatório
) %>%
separate(HibAmb, into = c("Hibrido", "Ambiente"), sep = "\\.", remove = FALSE)
# Predizer mu (severidade)
grid_pred$mu <- predict(m_gam2, newdata = grid_pred, type = "response", exclude = "s(curve_id)")
grid_pred$mu
df_media <- grid_pred %>%
group_by(Hibrido, DAE) %>%
summarise(mu_medio = mean(mu), .groups = "drop")
df_media
estabilidade_funcional <- grid_pred %>%
left_join(df_media, by = c("Hibrido", "DAE")) %>%
group_by(Hibrido, Ambiente) %>%
summarise(
dist_L2 = sqrt(sum((mu - mu_medio)^2)), # O desvio funcional
rAUDPS = sum(mu) / n(),                  # A métrica do Garnica para comparar
.groups = "drop"
)
View(estabilidade_funcional)
library(ggplot2)
library(ggrepel)
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
# 1. Calculando a média por híbrido para destacar no gráfico
df_signature <- grid_pred %>%
group_by(Hibrido, DAE) %>%
mutate(mu_medio = mean(mu)) %>%
ungroup()
# 2. Plotando a Assinatura Funcional
ggplot(df_signature, aes(x = DAE)) +
# Linhas dos ambientes (finas e transparentes)
geom_line(aes(y = mu, group = Ambiente, color = Ambiente),
linewidth = 0.5, alpha = 0.4) +
# Linha média do Híbrido (grossa e preta)
geom_line(aes(y = mu_medio), color = "black", linewidth = 1.2) +
facet_wrap(~Hibrido) +
scale_color_viridis_d(option = "mako") +
labs(
title = "Assinatura Funcional e Estabilidade Biológica",
subtitle = "Linha preta: Comportamento médio (Genótipo) | Cores: Variação por Ambiente",
x = "Dias Após Emergência (DAE)",
y = "Severidade Predita (mu)"
) +
theme_minimal() +
theme(legend.position = "none") # Opcional: remover legenda se houver muitos ambientes
# Criar grid de predição
grid_pred <- expand.grid(
DAE = seq(min(dat$DAE), max(dat$DAE), length.out = 100),
HibAmb = unique(dat$HibAmb),
curve_id = dat$curve_id[1] # valor de referência para o efeito aleatório
) %>%
separate(HibAmb, into = c("Hibrido", "Ambiente"), sep = "\\.", remove = FALSE)
# Predizer mu (severidade)
grid_pred$mu <- predict(m_gam2, newdata = grid_pred, type = "response", exclude = "s(curve_id)")
df_media <- grid_pred %>%
group_by(Hibrido, DAE) %>%
summarise(mu_medio = mean(mu), .groups = "drop")
estabilidade_funcional <- grid_pred %>%
left_join(df_media, by = c("Hibrido", "DAE")) %>%
group_by(Hibrido, Ambiente) %>%
summarise(
dist_L2 = sqrt(sum((mu - mu_medio)^2)), # O desvio funcional
rAUDPS = sum(mu) / n(),                  # A métrica do Garnica para comparar
.groups = "drop"
)
library(ggplot2)
library(ggrepel)
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
# 1. Calculando a média por híbrido para destacar no gráfico
df_signature <- grid_pred %>%
group_by(Hibrido, DAE) %>%
mutate(mu_medio = mean(mu)) %>%
ungroup()
# 2. Plotando a Assinatura Funcional
ggplot(df_signature, aes(x = DAE)) +
# Linhas dos ambientes (finas e transparentes)
geom_line(aes(y = mu, group = Ambiente, color = Ambiente),
linewidth = 0.5, alpha = 0.4) +
# Linha média do Híbrido (grossa e preta)
geom_line(aes(y = mu_medio), color = "black", linewidth = 1.2) +
facet_wrap(~Hibrido) +
scale_color_viridis_d(option = "mako") +
labs(
title = "Assinatura Funcional e Estabilidade Biológica",
subtitle = "Linha preta: Comportamento médio (Genótipo) | Cores: Variação por Ambiente",
x = "Dias Após Emergência (DAE)",
y = "Severidade Predita (mu)"
) +
theme_minimal() +
theme(legend.position = "none") # Opcional: remover legenda se houver muitos ambientes
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
facet_wrap(~Ambiente)+
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
ggplot(estabilidade_funcional, aes(x = rAUDPS, y = dist_L2)) +
geom_point(aes(color = Hibrido), size = 3, alpha = 0.7) +
geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
labs(
title = "Estabilidade Escalar (rAUDPS) vs. Estabilidade Funcional (IEF)",
subtitle = "Outliers representam híbridos onde a área da curva engana sobre a forma da epidemia",
x = "rAUDPS (Métrica de Garnica)",
y = "IEF (Distância L2 - Desvio da Trajetória)"
) +
theme_minimal() +
scale_color_viridis_d()
# 1. Calculando a média por híbrido para destacar no gráfico
df_signature <- grid_pred %>%
group_by(Hibrido, DAE) %>%
mutate(mu_medio = mean(mu)) %>%
ungroup()
# 2. Plotando a Assinatura Funcional
ggplot(df_signature, aes(x = DAE)) +
# Linhas dos ambientes (finas e transparentes)
geom_line(aes(y = mu, group = Ambiente, color = Ambiente),
linewidth = 0.5, alpha = 0.4) +
# Linha média do Híbrido (grossa e preta)
geom_line(aes(y = mu_medio), color = "black", linewidth = 1.2) +
facet_wrap(~Hibrido) +
scale_color_viridis_d(option = "mako") +
labs(
title = "Assinatura Funcional e Estabilidade Biológica",
subtitle = "Linha preta: Comportamento médio (Genótipo) | Cores: Variação por Ambiente",
x = "Dias Após Emergência (DAE)",
y = "Severidade Predita (mu)"
) +
theme_minimal() +
theme(legend.position = "none") # Opcional: remover legenda se houver muitos ambientes
